Hi

I am getting an error while deploying a gatsby site through amplify console. Instead of pushing the build artifacts to the amplify site, the workflow is pushing the test artifacts.

I am using a monorepo structure, and doing a gatsby build for frontend. Post build I need to run Lighthouse analysis and Structured data tests and access their results from console and then proceed with the deployment of website. Below is my amplify.yml. Could you please take and look. Am I doing anything wrong here ?

version: 1
applications:
  - appRoot: packages/web
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
        build:
          commands:
            - echo ------------- Build Web App -------------
            - npm run build
      artifacts:
        baseDirectory: public
        files:
          - "**/*"
      cache:
        paths:
          - node_modules/**/*
    test:
      phases:
        preTest:
          commands:
            - mkdir -p ci-test/lhci
            - mkdir -p ci-test/sdtt
        test:
          commands:
            - echo -------------- Run Sonar  -------------
            - npm install -g sonarqube-scanner
            - sonar-scanner -Dsonar.login=9045d3a03dc2b51933324e5968b4a540f356a1bf -Dsonar.host.url=https://sonar.unileversolutions.com/ -Dsonar.projectKey=bcp_canada -Dsonar.projectName=bcp_canada -Dsonar.sources=./public -D:sonar.scm.disabled=true && pwd
            - echo ------------- Run Lighthouse -------------
            - npm install -g @lhci/cli
            - lhci autorun --config=./lighthouserc.json
            - echo ------------- Run SDTT -------------
            - npm install -g structured-data-testing-tool
            - find ./public -name *.html -exec bash -c 'sdtt --file "${0}" -p Twitter,Facebook,SocialMedia -o ci-test/sdtt/"${0//[\.\/]/\-}".txt' {} \;
      artifacts:
        baseDirectory: public
        files:
          - "**/*"
